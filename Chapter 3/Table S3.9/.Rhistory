"Adipose" = "#A56A0B",
"Skeletal muscle" = "#fc8e5c",
"Liver" = "#609440",
"Brain" = "#b40001",
"Pituitary" = "#761063"
)
names(specific_color)= levels(p2_ordered$specific_Tissue)
annotation_row <- rowAnnotation(
Specific = p2_ordered$specific_Tissue,
col = list(Specific = specific_color))
##列注释
# 假设组织顺序为：
tissue_order <- c("Adipose", "Skeletal muscle", "Liver", "Brain", "Pituitary")
# 每个组织中特异表达的 circRNA 数量（你自己统计的）
table(p2_ordered$specific_Tissue)
# Adipose Skeletal muscle           Liver
# 316            1186             797
# Brain       Pituitary
# 2077             863
circRNA_counts <- c(316, 1186, 797, 2077, 863)
names(circRNA_counts) <- tissue_order
bar_colors  = c(
"Adipose" = "#A56A0B",
"Skeletal muscle" = "#fc8e5c",
"Liver" = "#609440",
"Brain" = "#b40001",
"Pituitary" = "#761063"
)
names(bar_colors)= levels(p2_ordered$specific_Tissue)
library(ComplexHeatmap)
top_anno <- HeatmapAnnotation(
Specific_circRNA = anno_barplot(
circRNA_counts,
gp = gpar(fill = bar_colors[names(circRNA_counts)]),  # ✅ 指定颜色
bar_width = 0.8,
border = FALSE
),
annotation_name_side = "left"
)
p <- Heatmap(
as.matrix(p3),
name = "Z-score",
cluster_rows = FALSE,
cluster_columns = FALSE,
show_column_names = TRUE,
show_row_names = FALSE,
col = rev(brewer.pal(11, "RdYlBu")),
right_annotation = row_anno,    # 添加右侧注释
top_annotation = top_anno
)
p <- Heatmap(
as.matrix(p3),
name = "Z-score",
cluster_rows = FALSE,
cluster_columns = FALSE,
show_column_names = TRUE,
show_row_names = FALSE,
col = rev(brewer.pal(11, "RdYlBu")),
#right_annotation = row_anno,    # 添加右侧注释
top_annotation = top_anno
)
p
# 找到这些基因在矩阵中的行位置
#highlight_rows <- which(rownames(p3) %in% highlight_genes)
highlight_genes <- c("sus_circME1_14", "sus_circOXR1_16", "sus_circPPARG_4","sus_circEHBP1_10","sus_circMYOT_14","sus_circABLIM2_12","sus_circUBE3A_4","sus_circMDFIC_9","sus_circGBE1_16","sus_circTEX9_17","sus_circMYBPC2_1","sus_circAGL_54","sus_circMYOT_14","sus_circSH3GLB1_14")
highlight_rows <- which(rownames(p3) %in% highlight_genes)
# 创建标注对象
row_anno <- rowAnnotation(
gene = anno_mark(at = highlight_rows,
labels = rownames(p3)[highlight_rows],
side = "right")
)
##行注释
p2_ordered$specific_Tissue <- factor(p2_ordered$specific_Tissue, levels = c("Adipose", "Skeletal muscle", "Liver", "Brain", "Pituitary"))
specific_color = c(
"Adipose" = "#A56A0B",
"Skeletal muscle" = "#fc8e5c",
"Liver" = "#609440",
"Brain" = "#b40001",
"Pituitary" = "#761063"
)
names(specific_color)= levels(p2_ordered$specific_Tissue)
annotation_row <- rowAnnotation(
Specific = p2_ordered$specific_Tissue,
col = list(Specific = specific_color))
##列注释
# 假设组织顺序为：
tissue_order <- c("Adipose", "Skeletal muscle", "Liver", "Brain", "Pituitary")
# 每个组织中特异表达的 circRNA 数量（你自己统计的）
table(p2_ordered$specific_Tissue)
# Adipose Skeletal muscle           Liver
# 316            1186             797
# Brain       Pituitary
# 2077             863
circRNA_counts <- c(316, 1186, 797, 2077, 863)
names(circRNA_counts) <- tissue_order
bar_colors  = c(
"Adipose" = "#A56A0B",
"Skeletal muscle" = "#fc8e5c",
"Liver" = "#609440",
"Brain" = "#b40001",
"Pituitary" = "#761063"
)
names(bar_colors)= levels(p2_ordered$specific_Tissue)
library(ComplexHeatmap)
top_anno <- HeatmapAnnotation(
Specific_circRNA = anno_barplot(
circRNA_counts,
gp = gpar(fill = bar_colors[names(circRNA_counts)]),  # ✅ 指定颜色
bar_width = 0.8,
border = FALSE
),
annotation_name_side = "left"
)
p <- Heatmap(
as.matrix(p3),
name = "Z-score",
cluster_rows = FALSE,
cluster_columns = FALSE,
show_column_names = TRUE,
show_row_names = FALSE,
col = rev(brewer.pal(11, "RdYlBu")),
right_annotation = row_anno,    # 添加右侧注释
top_annotation = top_anno
)
p
setwd("E:/工作电脑D盘/科研文档/UCD/Thesis/Qiaowei_PhD_Thesis_Supporting/Chapter 3")
circ=read.delim("Table S3.5.xlsx")
circ=read.delim("TableS3.5.txt",header = T,sep ='\t')
View(circ)
circ=read.delim("TableS3.4.txt",header = T,sep ='\t')
circ=read.delim("TableS3.4.txt",header = T,sep ='\t')
info=read.table("E:/办公室电脑/D/科研文档/lqw_circRNA/数据库/20220409整理样本/20221009percent10samples_circ_information_name.txt",header = T,sep = '\t')
View(info)
circ=read.delim("TableS3.4.txt",header = T,sep ='\t')
info=read.table("E:/办公室电脑/D/科研文档/lqw_circRNA/数据库/20220409整理样本/20221009percent10samples_circ_information_name.txt",header = T,sep = '\t')
circ2=merge(circ,info[,1:2],by="circ_id")
View(circ2)
circ2=merge(info[,1:2],circ,by="circ_id")
write.table(circ2,"TableS3_4.txt",sep ='\t',row.names = F,quote = F)
circ=read.table("20220805_morethan10samples.txt",header = T,sep ='\t')
info=read.table("E:/办公室电脑/D/科研文档/lqw_circRNA/数据库/20220409整理样本/通城_长白/20241001/specific_stage_analysis/20221009_morethan10samples_info2.txt",header = T,sep ='\t')
circ2=merge(info,circ,by="circ_id")
View(circ2)
circ2=merge(info[,c(1,4)],circ,by="circ_id")
circ2$circ_name <- sub("^[^_]*_", "", circ2$circ_name)
write.table(circ2,"TableS3_6.txt",sep ='\t',row.names = F,quote = F)
a=unique(circ2$gene_name)
a=unique(data.frame(circ2$gene_name))
b=unique(data.frame(circ2$gene_id))
142149+4979+2120+1713
####每种组织中特异表达的circRNA对应的宿主基因数目柱状图
setwd("D:/科研文档/lqw_circRNA/数据库/20220409整理样本/20220817_组织特异性分析")
####每种组织中特异表达的circRNA对应的宿主基因数目柱状图
setwd("E:/办公室电脑/D:/科研文档/lqw_circRNA/数据库/20220409整理样本/20220817_组织特异性分析")
####每种组织中特异表达的circRNA对应的宿主基因数目柱状图
setwd("E:/办公室电脑/D/科研文档/lqw_circRNA/数据库/20220409整理样本/20220817_组织特异性分析")
circ_number=read.table("20230303每种组织中特异表达的circRNA的宿主基因的数目.txt",header = T,sep ='\t')
library(ggplot2)
m_exp=read.table("E:/办公室电脑/D/科研文档/lqw_circRNA/数据库/20220409整理样本/20220817_组织特异性分析/20220827_mRNA组织特异性/20220825_total_mRNA.txt",header=T,sep ='\t',row.names=1)
m_exp2=t(m_exp)
m_exp3=merge(data5[,1:2],m_exp2,by="row.names")
m_exp3=m_exp3[,-3]
m_Mean=aggregate(m_exp3[,-1:-2],by=list(Tissue=m_exp3$Tissue),mean)##求平均值
m_exp3=merge(data5[,1:2],m_exp2,by="row.names")
data=read.table("20220803_morethan_percent10samples.txt",header=T,sep ='\t',row.names = 1)
data2=data[,-1:-6]
datasets=read.table("20220728_datasets.txt",header=T,sep='\t',row.names = 1)
data3=t(data2)
mode(data3)="numeric" ##将矩阵转换成数值型
data3=as.data.frame(data3)
data4=merge(datasets,data3,by="row.names")
##删除样本数小于10的样本，即只有样本数大于10的11种组织参与组织特异性分析
data5=subset(data4,Tissue!="Skin"&Tissue!="Stomach"&Tissue!="Kidney"&Tissue!="Uterus"&Tissue!="Lymph"&Tissue!="Cells"&Tissue!="Others"&Tissue!="Whole blood")
rownames(data5)=data5[,1]
data5=data5[,-1]
m_exp3=merge(data5[,1:2],m_exp2,by="row.names")
m_exp3=m_exp3[,-3]
m_Mean=aggregate(m_exp3[,-1:-2],by=list(Tissue=m_exp3$Tissue),mean)##求平均值
rownames(m_Mean)=m_Mean[,1]
m_Mean=m_Mean[,-1]
m_Mean2=t(m_Mean)
gene_id=rownames(m_Mean2)
m_Mean3=cbind(gene_id,m_Mean2)
rownames(m_Mean3)=NULL
m_Mean3=as.data.frame(m_Mean3)
circ_id=rownames(pheatmap)
pheatmap_circ=cbind(circ_id,pheatmap)
rownames(pheatmap_circ)=NULL
m_Mean4=merge(pheatmap_circ[,c(1,4:6)],m_Mean3,by="gene_id")
dim(pheatmap_circ)
View(pheatmap_circ)
rownames(m_exp3)=m_exp3[,1]
m_exp3=m_exp3[,-1]
m_exp4=t(m_exp3[,-1])
gene_id=rownames(m_exp4)
m_exp5=cbind(gene_id,m_exp4)
rownames(m_exp5)=NULL
m_exp5=as.data.frame(m_exp5)
m_exp6=merge(pheatmap_circ[,c(1,4:6)],m_exp5,by="gene_id")
hostgene_of_specific_circ=read.table("20220828_hostgene_mean_of_specific_circ.txt",header=T,sep ='\t',row.names = 1)
gene_max=apply(hostgene_of_specific_circ[,-1:-4],1, function(t) colnames(hostgene_of_specific_circ[,-1:-4])[which.max(t)])##筛选每行最大值的列名
hostgene_of_specific_circ2=cbind(hostgene_of_specific_circ,gene_max)
hostgene_of_specific_circ3=hostgene_of_specific_circ2[order(hostgene_of_specific_circ2$gene_max),]
hostgene_of_specific_circ4=hostgene_of_specific_circ3[c(1:96,2256:2436,765:934,977:1121,935:976,1122:2085,2751:3118,2437:2750,97:764,2086:2255),]
hostgene_of_specific_circ5=hostgene_of_specific_circ4[,c(-1:-4,-16)]
hostgene_of_specific_circ6=hostgene_of_specific_circ5[,c(1,9,3,5,4,6,7,11,10,2,8)]
colnames(hostgene_of_specific_circ6)[2]="Skeletal muscle"
View(hostgene_of_specific_circ6)
View(hostgene_of_specific_circ5)
View(hostgene_of_specific_circ4)
View(hostgene_of_specific_circ3)
View(hostgene_of_specific_circ4)
View(hostgene_of_specific_circ5)
View(hostgene_of_specific_circ6)
hostgene_of_specific_circ6=unique(hostgene_of_specific_circ6)
pheatmap_Tissue_specific_circ=pheatmap::pheatmap(hostgene_of_specific_circ6,
cluster_rows=F, cluster_cols=F,
cellwidth = 50,cellheight = 0.2,fontsize = 12,##每个单元格的宽度和高度以及图的字体大小
#annotation_row = annotation_info,
show_rownames=F,show_colnames=T,
color = colorRampPalette(c("#3c5689", "white", "#a41b3a"))(10),
#annotation_colors = ann_colors,
scale = "row",
filename = "20220828_The heatmap of  host gene of tissue specific  circRNAs.pdf")
table(hostgene_of_specific_circ3$gene_max)
hostgene_of_specific_circ3=unique(hostgene_of_specific_circ3)
table(hostgene_of_specific_circ3$gene_max)
hostgene_of_specific_circ3=unique(hostgene_of_specific_circ3[,-2])
table(hostgene_of_specific_circ3$gene_max)
dim(hostgene_of_specific_circ3)
####每种组织中特异表达的circRNA对应的宿主基因数目柱状图
setwd("E:/办公室电脑/D/科研文档/lqw_circRNA/数据库/20220409整理样本/20220817_组织特异性分析")
circ_number=read.table("20250820每种组织中特异表达的circRNA的宿主基因的数目.txt",header = T,sep ='\t')
library(ggplot2)
library(ggpubr)
library(RColorBrewer)
circ_number$Tissue= factor(circ_number$Tissue, levels = c("Adipose", "Skeletal muscle","Heart",  "Liver", "Intestine","Lung", "Ovary","Testis", "Spleen","Brain","Pituitary"))
cols=c("#A56A0B",	"#fc8e5c",	"#ffc2c7",	"#609440",	"#93a23a",	"#4BBC8D",	"#00b7e8",	"#7c878e",	"#d72f1f",	"#b40001",	"#761063")
p=ggplot(data = circ_number, mapping = aes(x=Tissue,y = Number,fill=Tissue)) + geom_bar(stat = 'identity')+ylab("The number of circRNAs")
p1=p+theme_classic()#去除背景色、网格线、右边和上边框线
p2=p1+theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5))#X轴标签倾斜45度
p3 =p2+scale_color_manual(values=cols) #设置柱子边的颜色
p4 =p3+scale_fill_manual(values=cols)
p5 =p4+theme(axis.text=element_text(size=12), #调整坐标轴刻度标签的大小
axis.title=element_text(size=12)) #调整标签的大小p5
p6 =p5+theme(legend.position = "none")##移除图例
p7 =p6+geom_text(aes(label = Number,vjust=0,hjust=0.5))
p7
dev.new()
p7
pdf("20250820the host gene number of specific circRNAs  in each tissue.pdf",4,3,encoding="MacRoman",bg="transparent")
p=ggplot(data = circ_number, mapping = aes(x=Tissue,y = Number,fill=Tissue)) + geom_bar(stat = 'identity')+ylab("The number of circRNAs")
pdf("20250820the_host_gene_number_of_specific_circRNAs_in each_tissue.pdf",4,3,bg="transparent")
p=ggplot(data = circ_number, mapping = aes(x=Tissue,y = Number,fill=Tissue)) + geom_bar(stat = 'identity')+ylab("The number of circRNAs")
p1=p+theme_classic()#去除背景色、网格线、右边和上边框线
p2=p1+theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5))#X轴标签倾斜45度
p3 =p2+scale_color_manual(values=cols) #设置柱子边的颜色
p4 =p3+scale_fill_manual(values=cols)
p5 =p4+theme(axis.text=element_text(size=12), #调整坐标轴刻度标签的大小
axis.title=element_text(size=12)) #调整标签的大小p5
p6 =p5+theme(legend.position = "none")##移除图例
p7 =p6+geom_text(aes(label = Number,vjust=0,hjust=0.5))
p7
dev.off()
549/973
549/1973
407/1973
dim(hostgene_of_specific_circ3)
write.table(hostgene_of_specific_circ3,"20250820host_gene_exp_of_tissue_specific_circ.txt",sep ='\t',row.names = F)
setwd("E:/工作电脑D盘/科研文档/UCD/Thesis/Qiaowei_PhD_Thesis_Supporting/Chapter 3/Table S3.10")
# 载入包（可选）
library(dplyr)
# 1. 获取当前文件夹下所有 txt 文件
files <- list.files(pattern = "\\.txt$")
# 2. 批量读取和处理
for (f in files) {
# 读取文件
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# 处理 circ_name 列：只保留第一个下划线之后的内容
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 删除第 8 列之后的所有列（只保留前 8 列）
if (ncol(df) > 8) {
df <- df[, 1:8]
}
# 保存处理后的文件（在文件名后加 _processed）
out_name <- sub("\\.txt$", "_processed.txt", f)
write.table(df, out_name, sep = "\t", quote = FALSE, row.names = FALSE)
}
setwd("E:/工作电脑D盘/科研文档/UCD/Thesis/Qiaowei_PhD_Thesis_Supporting/Chapter 3/Table S3.10_2")
# 载入包（可选）
library(dplyr)
# 1. 获取当前文件夹下所有 txt 文件
files <- list.files(pattern = "\\.txt$")
# 2. 批量读取和处理
for (f in files) {
# 读取文件
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# 处理 circ_name 列：只保留第一个下划线之后的内容
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 删除第 8 列之后的所有列（只保留前 8 列）
if (ncol(df) > 8) {
df <- df[, 1:8]
}
# 保存处理后的文件（在文件名后加 _processed）
out_name <- sub("\\.txt$", "_processed.txt", f)
write.table(df, out_name, sep = "\t", quote = FALSE, row.names = FALSE)
}
library(openxlsx)
setwd("E:/工作电脑D盘/科研文档/UCD/Thesis/Qiaowei_PhD_Thesis_Supporting/Chapter 3/Table S3.10")
library(openxlsx)
library(openxlsx)
# 1. 获取当前文件夹下所有 txt 文件
files <- list.files(pattern = "\\.txt$")
# 2. 创建一个新的 Excel workbook
wb <- createWorkbook()
# 3. 循环读取并处理每个文件
for (f in files) {
# 读取文件
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# 处理 circ_name 列：只保留第一个下划线之后的内容
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 删除第 8 列之后的列
if (ncol(df) > 8) {
df <- df[, 1:8]
}
# 添加 sheet，名字用文件名（去掉扩展名）
sheet_name <- sub("\\.txt$", "", f)
addWorksheet(wb, sheet_name)
# 写入数据
writeData(wb, sheet_name, df)
}
# 3. 循环读取并处理每个文件
for (f in files) {
# 读取文件
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# 处理 circ_name 列：只保留第一个下划线之后的内容
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 删除第 8 列之后的列
if (ncol(df) > 8) {
df <- df[, 1:8]
}
# 添加 sheet，名字用文件名（去掉扩展名）
sheet_name <- sub("\\.txt$", "", f)
addWorksheet(wb, sheet_name1,31)
# 写入数据
writeData(wb, sheet_name, df)
}
library(openxlsx)
# 1. 获取当前文件夹下所有 txt 文件
files <- list.files(pattern = "\\.txt$")
# 2. 创建一个新的 Excel workbook
wb <- createWorkbook()
# 3. 循环读取并处理每个文件
for (f in files) {
# 读取文件
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# 处理 circ_name 列：只保留第一个下划线之后的内容
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 删除第 8 列之后的列
if (ncol(df) > 8) {
df <- df[, 1:8]
}
# 添加 sheet，名字用文件名（去掉扩展名）
sheet_name <- sub("\\.txt$", "", f)
addWorksheet(wb, sheet_name,1,31)
# 写入数据
writeData(wb, sheet_name, df)
}
library(openxlsx)
files <- list.files(pattern = "\\.txt$")
wb <- createWorkbook()
for (f in files) {
# 读取
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# circ_name 只保留第一个下划线之后
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 保留前 8 列
if (ncol(df) > 8) df <- df[, 1:8]
# 生成简短 sheet 名：去掉 DEC_Adipose_
sheet_name <- sub("^DEC_Adipose_", "", f)
sheet_name <- sub("\\.txt$", "", sheet_name)
sheet_name <- substr(sheet_name, 1, 31)  # 保证 <=31 个字符
# 添加 sheet 并写入数据
addWorksheet(wb, sheet_name)
writeData(wb, sheet_name, df)
}
# 保存 Excel
saveWorkbook(wb, "All_circRNAs_processed.xlsx", overwrite = TRUE)
library(openxlsx)
# 假设你的文件都在这个文件夹里
files <- list.files(pattern = "\\.txt$")
# 创建一个 Excel 工作簿
wb <- createWorkbook()
for (file in files) {
# 读入数据
df <- read.csv(file, stringsAsFactors = FALSE)
# circ_name 只保留第一个下划线之后
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 对所有字符串做替换，把 sus_circME1_14 换成 circME1
df[] <- lapply(df, function(x) {
if (is.character(x)) {
gsub("circME1_14", "circME1", x)
} else {
x
}
})
# 生成 sheet 名称（不超过 31 个字符）
sheet_name <- substr(tools::file_path_sans_ext(basename(file)), 1, 31)
# 添加 sheet 并写入数据
addWorksheet(wb, sheet_name)
writeData(wb, sheet_name, df)
}
library(openxlsx)
# 假设你的文件都在这个文件夹里
files <- list.files(pattern = "\\.txt$")
# 创建一个 Excel 工作簿
wb <- createWorkbook()
for (file in files) {
# 读入数据
df <- read.csv(file, stringsAsFactors = FALSE)
# circ_name 只保留第一个下划线之后
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 对所有字符串做替换，把 sus_circME1_14 换成 circME1
df[] <- lapply(df, function(x) {
if (is.character(x)) {
gsub("circME1_14", "circME1", x)
} else {
x
}
})
# 生成 sheet 名称（不超过 31 个字符）
sheet_name <- substr(tools::file_path_sans_ext(basename(file)), 1, 31)
# 添加 sheet 并写入数据
addWorksheet(wb, sheet_name)
writeData(wb, sheet_name, df)
}
library(openxlsx)
files <- list.files(pattern = "\\.txt$")
wb <- createWorkbook()
for (f in files) {
# 读取
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# circ_name 只保留第一个下划线之后
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 保留前 8 列
if (ncol(df) > 8) df <- df[, 1:8]
# 对所有字符串做替换，把 sus_circME1_14 换成 circME1
df[] <- lapply(df, function(x) {
if (is.character(x)) {
gsub("circME1_14", "circME1", x)
} else {
x
}
})
# 生成简短 sheet 名：去掉 DEC_Adipose_
sheet_name <- sub("^DEC_Adipose_", "", f)
sheet_name <- sub("\\.txt$", "", sheet_name)
sheet_name <- substr(sheet_name, 1, 31)  # 保证 <=31 个字符
# 添加 sheet 并写入数据
addWorksheet(wb, sheet_name)
writeData(wb, sheet_name, df)
}
# 保存 Excel
saveWorkbook(wb, "All_circRNAs_processed.xlsx", overwrite = TRUE)
##Table S9
setwd("E:/工作电脑D盘/科研文档/UCD/Thesis/Qiaowei_PhD_Thesis_Supporting/Chapter 3/Table S3.9_2")
##Table S9
setwd("E:/工作电脑D盘/科研文档/UCD/Thesis/Qiaowei_PhD_Thesis_Supporting/Chapter 3/Table S3.9_2")
library(openxlsx)
files <- list.files(pattern = "\\.txt$")
wb <- createWorkbook()
for (f in files) {
# 读取
df <- read.table(f, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# circ_name 只保留第一个下划线之后
df$circ_name <- sub("^[^_]*_", "", df$circ_name)
# 保留前 8 列
if (ncol(df) > 8) df <- df[, 1:8]
# 对所有字符串做替换，把 sus_circME1_14 换成 circME1
# df[] <- lapply(df, function(x) {
#   if (is.character(x)) {
#     gsub("circME1_14", "circME1", x)
#   } else {
#     x
#   }
# })
#
# 替换规则
replace_map <- c(
"circME1_14"   = "circME1",
"circOXR1_16"  = "circOXR1",
"circEHBP1_10" = "circEHBP1"
)
df[] <- lapply(df, function(x) {
if (is.character(x)) {
for (pattern in names(replace_map)) {
x <- gsub(pattern, replace_map[pattern], x)
}
}
x
})
# 生成简短 sheet 名：去掉 DEC_Adipose_
sheet_name <- sub("^DEC_Adipose_", "", f)
sheet_name <- sub("\\.txt$", "", sheet_name)
sheet_name <- substr(sheet_name, 1, 31)  # 保证 <=31 个字符
# 添加 sheet 并写入数据
addWorksheet(wb, sheet_name)
writeData(wb, sheet_name, df)
}
# 保存 Excel
saveWorkbook(wb, "All_circRNAs_processed.xlsx", overwrite = TRUE)
